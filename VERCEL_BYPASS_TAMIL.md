# Vercel API வரம்பை தவிர்ப்பதற்கான வழிகள் மற்றும் எதிர்கொண்ட சிக்கல்கள் (Vercel API Limit Bypass & Troubleshooting)

Vercel Hobby திட்டத்தில் உள்ள 12 Serverless Function வரம்பை மீறாமல் இருக்க, நாம் மேற்கொண்ட இரண்டு முயற்சிகள் மற்றும் அதில் ஏற்பட்ட சிக்கல்கள் பற்றிய தொகுப்பு கீழே கொடுக்கப்பட்டுள்ளது.

## 1. முறை 1: ஒற்றை செயல்பாட்டு முறை (The Monolithic Approach) - *தோல்வி*

எல்லா API கோரிக்கைகளையும் (`/api/*`) ஒரே `api/index.js` கோப்பிற்கு திருப்பிவிடும் முயற்சி.

*   **செயல்முறை:** `server.js` இல் உள்ள அனைத்து லாஜிக்கையும் ஒரே `api/index.js` கோப்பிற்கு மாற்றினோம்.
*   **எதிர்கொண்ட சிக்கல்:** 
    *   `vercel.json` இல் உள்ள Rewrite விதிகளில் குழப்பம் ஏற்பட்டது.
    *   Frontend மற்றும் Backend ரவுட்டிங் (Routing) ஒன்றுடன் ஒன்று மோதிக்கொண்டன. இதனால் சில API அழைப்புகள் சரியாக வேலை செய்யவில்லை.

---

## 2. முறை 2: குழுவாக்கப்பட்ட டைனமிக் ரவுட்டிங் (Grouped Dynamic Routing) - *வெற்றி* ✅

ஒவ்வொரு தனித்தனி ஃபங்ஷனுக்கும் பதிலாக, தொடர்புடையவைகளை குழுக்களாகப் பிரித்து அமைத்தோம்.

*   **செயல்முறை:**
    *   `api/auth/[action].js` -> Login, Register, Google Auth அனைத்தையும் கையாள்கிறது.
    *   `api/products/index.js` மற்றும் `[id].js` -> தயாரிப்புகளை கையாள்கிறது.
    *   `api/common/[endpoint].js` -> Config, Reviews, Stats போன்ற பொதுவானவைகளை ஒரே இடத்தில் கையாள்கிறது.
*   **முடிவு:** 12-க்கும் மேற்பட்ட தனித்தனி ஃபங்ஷன்களுக்கு பதிலாக, இப்போது வெறும் 8 ஃபங்ஷன்களே உள்ளன. இது Vercel வரம்பிற்குள் பாதுகாப்பாக உள்ளது.

---

## எதிர்கொண்ட முக்கிய பிழைகள் மற்றும் தீர்வுகள் (Errors & Solutions)

இந்த முறையை செயல்படுத்தும்போது நாம் எதிர்கொண்ட முக்கிய பிழைகள்:

### 1. 500 Internal Server Error (Deployment-க்கு பிறகு)
வரிசைப்படுத்திய பிறகு (After Deployment) API 500 பிழையை காட்டியது.

*   **காரணம் 1 (மிக முக்கியம்):** Vercel Dashboard-ல் Environment Variables (`.env` file content) பதிவேற்றப்படவில்லை. Database URL மற்றும் ரகசிய குறியீடுகள் இல்லாததால் சர்வர் செயலிழந்தது.
*   **காரணம் 2 (Technical):** Database Connection "Cold Start" பிரச்சனை. சர்வர் தூங்கி எழுந்திருக்கும் முன் DB கனெக்ஷன் கிடைக்காததால் பிழை ஏற்பட்டது.
*   **தீர்வு:** `lib/db.js` இல் `bufferCommands: true` என மாற்றினோம் மற்றும் Vercel Settings-ல் `.env` மதிப்புகளைச் சேர்த்தோம்.

### 2. 404 Not Found (ரவுட்டிங் பிழை)
சில API ரிக்வெஸ்ட்கள் (`/api/auth/me`) வேலை செய்யவில்லை.

*   **காரணம்:** `vercel.json` கோப்பில் இருந்த ஒரு விதி, அனைத்து ரிக்வெஸ்ட்களையும் Frontend-க்கு (`/client/index.html`) திருப்பிவிட்டது. இதனால் API அழைப்புகளும் HTML பக்கத்தைத் தேடின.
*   **தீர்வு:** `vercel.json` இல் API பாதைகளைத் தவிர்த்து (`(?!api/.*)`), மற்றவற்றை மட்டும் Frontend-க்கு அனுப்புமாறு விதியை மாற்றினோம்.

### 3. Parameter Naming Conflict (பெயர் குழப்பம்)
`/api/common/reviews?type=app` என்று அழைக்கும்போது பிழை ஏற்பட்டது.

*   **காரணம்:** கோப்பின் பெயர் `[type].js` என இருந்தது. URL-ல் வரும் `?type=app` என்பதும் ஒரே பெயரில் இருந்ததால், குறியீட்டில் குழப்பம் ஏற்பட்டது.
*   **தீர்வு:** கோப்பின் பெயரை `[endpoint].js` என மாற்றினோம். இப்போது `endpoint` என்பது பாதையையும், `type` என்பது ஃபில்டரையும் குறிக்கிறது.

---

**முடிவுரை:**
இரண்டாவது முறையான **Grouped Dynamic Routing** மிகச் சிறப்பாக செயல்படுகிறது. இது Vercel-ன் வரம்புகளுக்குள் இருப்பதோடு, பராமரிப்பதற்கும் எளிதாக உள்ளது.
